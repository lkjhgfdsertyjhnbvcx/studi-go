{"version":3,"sources":["../../../../../music-studio-app/src/actions/studio.ts","../../../../../music-studio-app/src/lib/db-local.ts","../../../../../music-studio-app/src/actions/admin.ts","../../../../../music-studio-app/.next-internal/server/app/admin/%28protected%29/studios/%5Bid%5D/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["\"use server\";\n\nimport {\n    getAllStudiosFromFirestore,\n    getStudioByIdFromFirestore,\n    saveStudioToFirestore,\n    deleteStudioFromFirestore\n} from \"@/lib/db-firestore\";\nimport { StudioProfile } from \"@/lib/db-studio\";\nimport { revalidatePath } from \"next/cache\";\nimport { v4 as uuidv4 } from \"uuid\";\n\n// Get All\nexport async function fetchStudios() {\n    return getAllStudiosFromFirestore();\n}\n\n// Get One\nexport async function fetchStudio(id: string) {\n    return getStudioByIdFromFirestore(id);\n}\n\n// Upsert\nexport async function updateStudio(data: StudioProfile) {\n    try {\n        await saveStudioToFirestore(data);\n        revalidatePath(\"/studios\");\n        revalidatePath(`/studios/${data.id}`);\n        return { success: true, message: \"Studio saved successfully.\" };\n    } catch (e: any) {\n        return { success: false, message: e.message };\n    }\n}\n\n// Create New\nexport async function createNewStudioAction() {\n    const newStudio: StudioProfile = {\n        id: uuidv4(),\n        storeName: \"New Studio\",\n        representative: \"\",\n        manager: \"\",\n        contactPerson: \"\",\n        address: \"\",\n        phone: \"\",\n        email: \"\",\n        businessHours: { weekday: \"10:00-22:00\", saturday: \"10:00-22:00\", sundayHoliday: \"10:00-22:00\" },\n        url: \"\",\n        studioCount: 0,\n        rooms: [],\n        studentDiscount: { enabled: false, discountType: 'amount', value: 0 },\n        otherDiscounts: [],\n        personalPracticeSettings: { enabled: true, reservationWindowType: 'days', reservationWindowValue: 1, maxPeople: 2 },\n        designSettings: { logoSize: 100, backgroundColor: \"#000000\", backgroundType: 'color' },\n        equipmentOptions: [],\n        createdAt: new Date().toISOString()\n    };\n    await saveStudioToFirestore(newStudio);\n    revalidatePath(\"/studios\");\n    return newStudio.id;\n}\n\n// Delete\nexport async function deleteStudioAction(id: string) {\n    await deleteStudioFromFirestore(id);\n    revalidatePath(\"/studios\");\n    return { success: true };\n}\n","import {\n    getAllBookingsFromFirestore,\n    getBookingByIdFromFirestore,\n    saveBookingToFirestore,\n    updateBookingInFirestore,\n    checkAvailabilityFromFirestore\n} from './db-firestore';\n\nexport interface Booking {\n    id: string;\n    userId: string;\n    studioId: string;\n    roomName?: string;\n    date: string;       // YYYY-MM-DD\n    startTime: string;  // HH:mm\n    durationHours: number;\n    userCount: number;\n    totalPrice: number;\n    status: 'active' | 'cancelled' | 'modified' | 'no_show';\n    createdAt: string;\n    isPersonalPractice?: boolean;\n}\n\nexport const getBookings = async (): Promise<Booking[]> => {\n    return getAllBookingsFromFirestore();\n};\n\nexport const getBookingById = async (id: string): Promise<Booking | undefined> => {\n    return getBookingByIdFromFirestore(id);\n};\n\nexport const saveBooking = async (booking: Booking): Promise<void> => {\n    await saveBookingToFirestore(booking);\n};\n\nexport const updateBooking = async (id: string, updates: Partial<Booking>): Promise<boolean> => {\n    return updateBookingInFirestore(id, updates);\n};\n\n// Check for overlaps\nexport const checkAvailability = async (\n    studioId: string,\n    roomName: string | undefined,\n    date: string,\n    startTime: string,\n    duration: number,\n    excludeBookingId?: string\n): Promise<boolean> => {\n    return checkAvailabilityFromFirestore(studioId, roomName, date, startTime, duration, excludeBookingId);\n};\n","\"use server\";\n\nimport { getBookings, updateBooking } from \"@/lib/db-local\";\nimport { getAllUsersFromFirestore } from \"@/lib/db-firestore\";\nimport { User } from \"./auth\";\n\nexport async function fetchBookings() {\n    const bookings = await getBookings();\n    return bookings.sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\n}\n\nexport async function fetchBookingsByStudio(studioId: string) {\n    const allBookings = await getBookings();\n    return allBookings\n        .filter(booking => booking.studioId === studioId)\n        .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\n}\n\nexport async function updateBookingStatus(id: string, status: 'active' | 'cancelled' | 'modified' | 'no_show') {\n    return await updateBooking(id, { status });\n}\n\nexport async function fetchUsers() {\n    const users = await getAllUsersFromFirestore();\n    return users.sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\n}\n\nexport async function fetchUsersByStudio(studioId: string) {\n    const allBookings = await getBookings();\n    const studioBookings = allBookings.filter(b => b.studioId === studioId);\n    const users = await getAllUsersFromFirestore();\n\n    const result = users\n        .filter(user => studioBookings.some(b => b.userId === user.id))\n        .map(user => ({\n            ...user,\n            bookings: studioBookings\n                .filter(b => b.userId === user.id)\n                .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime())\n        }));\n\n    return result.sort((a, b) => {\n        // Sort by the most recent booking in this studio\n        const lastA = new Date(a.bookings[0].createdAt).getTime();\n        const lastB = new Date(b.bookings[0].createdAt).getTime();\n        return lastB - lastA;\n    });\n}\n","export {adminLogout as '006af075316706db006bce5619a543b7baa153f247'} from 'ACTIONS_MODULE0'\nexport {getAuthInfo as '0085772fd2329d46f7302aede12ceb7d687cfee89e'} from 'ACTIONS_MODULE0'\nexport {checkAdminAuth as '0089a1f7cb2a7fadf26749d87f9fcdbc1f15b236d8'} from 'ACTIONS_MODULE0'\nexport {requireAdminAuth as '00cc8a2f516f8fd155c8dc632b4a1c0a38dab84afa'} from 'ACTIONS_MODULE0'\nexport {storeLogin as '40530a7c11e54431ea05abc98c22a440f2a6e9ff9a'} from 'ACTIONS_MODULE0'\nexport {adminLogin as '60dc2d980d08fe70a6632f1c2387a539aa45c05dbf'} from 'ACTIONS_MODULE0'\nexport {adminLogout as '006af075316706db006bce5619a543b7baa153f247'} from 'ACTIONS_MODULE0'\nexport {getAuthInfo as '0085772fd2329d46f7302aede12ceb7d687cfee89e'} from 'ACTIONS_MODULE0'\nexport {fetchStudios as '00e4c93b8752da6310062bf7641dee775c057867ca'} from 'ACTIONS_MODULE1'\nexport {fetchStudio as '40f3f415047df7d6f80b4eeb845beddaafcd2f52bb'} from 'ACTIONS_MODULE1'\nexport {updateStudio as '404b0dc80b6afb3ebc6ef733601d064b54b160fee4'} from 'ACTIONS_MODULE1'\nexport {createNewStudioAction as '00c0bbb4b1415d1cd7c9373ddf7699da1ac1714148'} from 'ACTIONS_MODULE1'\nexport {deleteStudioAction as '40273ea227268ba866faf368020cc212388113d420'} from 'ACTIONS_MODULE1'\nexport {fetchBookingsByStudio as '40f78867e18f8376fe5c55dc7e237af08014f91a1b'} from 'ACTIONS_MODULE2'\nexport {updateBookingStatus as '600501332cee67ba135c41c97f3745937984c9c690'} from 'ACTIONS_MODULE2'\n"],"names":[],"mappings":"wDAEA,EAAA,EAAA,CAAA,CAAA,OAOA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAGO,eAAe,IAClB,MAAO,CAAA,EAAA,EAAA,0BAAA,AAA0B,GACrC,CAGO,eAAe,EAAY,CAAU,EACxC,MAAO,CAAA,EAAA,EAAA,0BAAA,AAA0B,EAAC,EACtC,CAGO,eAAe,EAAa,CAAmB,EAClD,GAAI,CAIA,OAHA,MAAM,CAAA,EAAA,EAAA,qBAAA,AAAqB,EAAC,GAC5B,CAAA,EAAA,EAAA,cAAA,AAAc,EAAC,YACf,CAAA,EAAA,EAAA,cAAc,AAAd,EAAe,CAAC,SAAS,EAAE,EAAK,EAAE,CAAA,CAAE,EAC7B,CAAE,SAAS,EAAM,QAAS,4BAA6B,CAClE,CAAE,MAAO,EAAQ,CACb,MAAO,CAAE,SAAS,EAAO,QAAS,EAAE,OAAO,AAAC,CAChD,CACJ,CAGO,eAAe,IAClB,IAAM,EAA2B,CAC7B,GAAI,CAAA,EAAA,EAAA,EAAA,AAAM,IACV,UAAW,aACX,eAAgB,GAChB,QAAS,GACT,cAAe,GACf,QAAS,GACT,MAAO,GACP,MAAO,GACP,cAAe,CAAE,QAAS,cAAe,SAAU,cAAe,cAAe,aAAc,EAC/F,IAAK,GACL,YAAa,EACb,MAAO,EAAE,CACT,gBAAiB,CAAE,QAAS,GAAO,aAAc,SAAU,MAAO,CAAE,EACpE,eAAgB,EAAE,CAClB,yBAA0B,CAAE,SAAS,EAAM,sBAAuB,OAAQ,uBAAwB,EAAG,UAAW,CAAE,EAClH,eAAgB,CAAE,SAAU,IAAK,gBAAiB,UAAW,eAAgB,OAAQ,EACrF,iBAAkB,EAAE,CACpB,UAAW,IAAI,OAAO,WAAW,EACrC,EAGA,OAFA,MAAM,CAAA,EAAA,EAAA,qBAAA,AAAqB,EAAC,GAC5B,CAAA,EAAA,EAAA,cAAA,AAAc,EAAC,YACR,EAAU,EACrB,AADuB,CAIhB,eAAe,EAAmB,CAAU,EAG/C,OAFA,MAAM,CAAA,EAAA,EAAA,yBAAA,AAAyB,EAAC,GAChC,CAAA,EAAA,EAAA,cAAA,AAAc,EAAC,YACR,CAAE,SAAS,CAAK,CAC3B,0CArDsB,EAKA,EAKA,EAYA,EA2BA,IAjDA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,MAKA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,MAKA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,MAYA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,MA2BA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,4JC9DtB,IAAA,EAAA,EAAA,CAAA,CAAA,OAuBO,IAAM,EAAc,SAChB,CAAA,EAAA,EAAA,2BAAA,AAA2B,IAWzB,EAAgB,MAAO,EAAY,IACrC,CAAA,EAAA,EAAA,wBAAA,AAAwB,EAAC,EAAI,wFClCxC,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAGO,eAAe,IAElB,MAAO,CADU,MAAM,CAAA,EAAA,EAAA,WAAW,AAAX,GAAW,EAClB,IAAI,CAAC,CAAC,EAAG,IAAM,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO,GAAK,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO,GAClG,CAEO,eAAe,EAAsB,CAAgB,EAExD,MAAO,CADa,MAAM,CAAA,EAAA,EAAA,WAAA,AAAW,GAAA,EAEhC,MAAM,CAAC,GAAW,EAAQ,QAAQ,GAAK,GACvC,IAAI,CAAC,CAAC,EAAG,IAAM,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO,GAAK,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO,GACvF,CAEO,eAAe,EAAoB,CAAU,CAAE,CAAuD,EACzG,OAAO,MAAM,CAAA,EAAA,EAAA,aAAa,AAAb,EAAc,EAAI,QAAE,CAAO,EAC5C,CAEO,eAAe,IAElB,MAAO,CADO,MAAM,CAAA,EAAA,EAAA,wBAAA,AAAwB,GAAA,EAC/B,IAAI,CAAC,CAAC,EAAG,IAAM,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO,GAAK,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO,GAC/F,CAEO,eAAe,EAAmB,CAAgB,EAErD,IAAM,EAAiB,CADH,MAAM,CAAA,EAAA,EAAA,WAAA,AAAW,GAAA,EACF,MAAM,CAAC,GAAK,EAAE,QAAQ,GAAK,GAY9D,MATe,AAFD,AAWP,OAXa,CAAA,EAAA,EAAA,wBAAA,AAAwB,GAAA,EAGvC,MAAM,CAAC,GAAQ,EAAe,IAAI,CAAC,GAAK,EAAE,MAAM,GAAK,EAAK,EAAE,GAC5D,GAAG,CAAC,IAAS,CACV,EADS,CACN,CAAI,CACP,SAAU,EACL,MAAM,CAAC,GAAK,EAAE,MAAM,GAAK,EAAK,EAAE,EAChC,IAAI,CAAC,CAAC,EAAG,IAAM,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO,GAAK,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO,IACvF,CAAC,EAES,IAAI,CAAC,CAAC,EAAG,KAEnB,IAAM,EAAQ,IAAI,KAAK,EAAE,QAAQ,CAAC,EAAE,CAAC,SAAS,EAAE,OAAO,GAEvD,OADc,AACP,IADW,KAAK,EAAE,QAAQ,CAAC,EAAE,CAAC,SAAS,EAAE,OAAO,GACxC,CACnB,EACJ,0CAzCsB,EAKA,EAOA,EAIA,EAKA,IArBA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,MAKA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,MAOA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,MAIA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,MAKA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,mKC3BtB,IAAA,EAAA,EAAA,CAAA,CAAA,OAQA,EAAA,EAAA,CAAA,CAAA,OAKA,EAAA,EAAA,CAAA,CAAA"}