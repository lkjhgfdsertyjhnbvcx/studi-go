{"version":3,"sources":["../../../../../music-studio-app/node_modules/next/src/build/webpack/loaders/next-flight-loader/server-reference.ts","../../../../../music-studio-app/node_modules/next/src/build/webpack/loaders/next-flight-loader/action-validate.ts","../../../../../music-studio-app/node_modules/uuid/dist-node/native.js","../../../../../music-studio-app/node_modules/uuid/dist-node/rng.js","../../../../../music-studio-app/node_modules/uuid/dist-node/regex.js","../../../../../music-studio-app/node_modules/uuid/dist-node/validate.js","../../../../../music-studio-app/node_modules/uuid/dist-node/stringify.js","../../../../../music-studio-app/node_modules/uuid/dist-node/v4.js","../../../../../music-studio-app/src/actions/reset-password.ts","../../../../../music-studio-app/.next-internal/server/app/reset-password/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\nexport { registerServerReference } from 'react-server-dom-webpack/server'\n","// This function ensures that all the exported values are valid server actions,\n// during the runtime. By definition all actions are required to be async\n// functions, but here we can only check that they are functions.\nexport function ensureServerEntryExports(actions: any[]) {\n  for (let i = 0; i < actions.length; i++) {\n    const action = actions[i]\n    if (typeof action !== 'function') {\n      throw new Error(\n        `A \"use server\" file can only export async functions, found ${typeof action}.\\nRead more: https://nextjs.org/docs/messages/invalid-use-server-value`\n      )\n    }\n  }\n}\n","import { randomUUID } from 'node:crypto';\nexport default { randomUUID };\n","import { randomFillSync } from 'node:crypto';\nconst rnds8Pool = new Uint8Array(256);\nlet poolPtr = rnds8Pool.length;\nexport default function rng() {\n    if (poolPtr > rnds8Pool.length - 16) {\n        randomFillSync(rnds8Pool);\n        poolPtr = 0;\n    }\n    return rnds8Pool.slice(poolPtr, (poolPtr += 16));\n}\n","export default /^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;\n","import REGEX from './regex.js';\nfunction validate(uuid) {\n    return typeof uuid === 'string' && REGEX.test(uuid);\n}\nexport default validate;\n","import validate from './validate.js';\nconst byteToHex = [];\nfor (let i = 0; i < 256; ++i) {\n    byteToHex.push((i + 0x100).toString(16).slice(1));\n}\nexport function unsafeStringify(arr, offset = 0) {\n    return (byteToHex[arr[offset + 0]] +\n        byteToHex[arr[offset + 1]] +\n        byteToHex[arr[offset + 2]] +\n        byteToHex[arr[offset + 3]] +\n        '-' +\n        byteToHex[arr[offset + 4]] +\n        byteToHex[arr[offset + 5]] +\n        '-' +\n        byteToHex[arr[offset + 6]] +\n        byteToHex[arr[offset + 7]] +\n        '-' +\n        byteToHex[arr[offset + 8]] +\n        byteToHex[arr[offset + 9]] +\n        '-' +\n        byteToHex[arr[offset + 10]] +\n        byteToHex[arr[offset + 11]] +\n        byteToHex[arr[offset + 12]] +\n        byteToHex[arr[offset + 13]] +\n        byteToHex[arr[offset + 14]] +\n        byteToHex[arr[offset + 15]]).toLowerCase();\n}\nfunction stringify(arr, offset = 0) {\n    const uuid = unsafeStringify(arr, offset);\n    if (!validate(uuid)) {\n        throw TypeError('Stringified UUID is invalid');\n    }\n    return uuid;\n}\nexport default stringify;\n","import native from './native.js';\nimport rng from './rng.js';\nimport { unsafeStringify } from './stringify.js';\nfunction _v4(options, buf, offset) {\n    options = options || {};\n    const rnds = options.random ?? options.rng?.() ?? rng();\n    if (rnds.length < 16) {\n        throw new Error('Random bytes length must be >= 16');\n    }\n    rnds[6] = (rnds[6] & 0x0f) | 0x40;\n    rnds[8] = (rnds[8] & 0x3f) | 0x80;\n    if (buf) {\n        offset = offset || 0;\n        if (offset < 0 || offset + 16 > buf.length) {\n            throw new RangeError(`UUID byte range ${offset}:${offset + 15} is out of buffer bounds`);\n        }\n        for (let i = 0; i < 16; ++i) {\n            buf[offset + i] = rnds[i];\n        }\n        return buf;\n    }\n    return unsafeStringify(rnds);\n}\nfunction v4(options, buf, offset) {\n    if (native.randomUUID && !buf && !options) {\n        return native.randomUUID();\n    }\n    return _v4(options, buf, offset);\n}\nexport default v4;\n","\"use server\";\n\nimport fs from 'fs';\nimport path from 'path';\nimport { v4 as uuidv4 } from 'uuid';\nimport { Resend } from 'resend';\n\nconst USERS_DB_PATH = path.join(process.cwd(), 'data', 'users.json');\nconst resend = new Resend(process.env.RESEND_API_KEY);\n\n// Helper functions\nconst getUsers = (): any[] => {\n    if (!fs.existsSync(USERS_DB_PATH)) return [];\n    try {\n        const data = fs.readFileSync(USERS_DB_PATH, 'utf-8');\n        return JSON.parse(data);\n    } catch {\n        return [];\n    }\n}\n\nconst saveUsers = (users: any[]) => {\n    fs.writeFileSync(USERS_DB_PATH, JSON.stringify(users, null, 2));\n}\n\n// 1. Send Password Reset Email\nexport async function sendPasswordResetAction(formData: FormData) {\n    const email = formData.get('email') as string;\n\n    if (!email) {\n        return { success: false, message: 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚' };\n    }\n\n    const users = getUsers();\n    const userIndex = users.findIndex((u: any) => u.email === email);\n    const user = users[userIndex];\n\n    if (!user) {\n        return { success: false, message: 'ã“ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚' };\n    }\n\n    // Generate Token\n    const resetToken = uuidv4();\n    const resetTokenExpiry = Date.now() + 3600000; // 1 hour from now\n\n    // Save Token to User\n    user.resetToken = resetToken;\n    user.resetTokenExpiry = resetTokenExpiry;\n    users[userIndex] = user;\n    saveUsers(users);\n\n    // Send Email\n    const baseUrl = process.env.NEXT_PUBLIC_BASE_URL || 'http://localhost:3000';\n    const resetUrl = `${baseUrl}/reset-password?token=${resetToken}`;\n\n    if (process.env.RESEND_API_KEY) {\n        try {\n            const { error } = await resend.emails.send({\n                from: 'Studi-Go <onboarding@resend.dev>',\n                to: email,\n                subject: 'ã€Studi-Goã€‘ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å†è¨­å®šã®ã”æ¡ˆå†…',\n                html: `\n                    <h1>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å†è¨­å®š</h1>\n                    <p>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å†è¨­å®šãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸã€‚</p>\n                    <p>ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚</p>\n                    <p><a href=\"${resetUrl}\">${resetUrl}</a></p>\n                    <p>ã“ã®ãƒªãƒ³ã‚¯ã¯1æ™‚é–“æœ‰åŠ¹ã§ã™ã€‚</p>\n                    <p>ãŠå¿ƒå½“ãŸã‚ŠãŒãªã„å ´åˆã¯ã€ã“ã®ãƒ¡ãƒ¼ãƒ«ã‚’ç„¡è¦–ã—ã¦ãã ã•ã„ã€‚</p>\n                `\n            });\n\n            if (error) {\n                console.error('[Reset Password] âŒ Resend Error (Returned):', error);\n                console.log(`[Reset Password] âš ï¸ Email failed. DEV MODE: Reset URL is ${resetUrl}`);\n                // For development convenience, return success with the link if email fails\n                return { success: true, message: `(é–‹ç™ºãƒ¢ãƒ¼ãƒ‰) ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸãŒã€ãƒªã‚»ãƒƒãƒˆURLã‚’ç™ºè¡Œã—ã¾ã—ãŸ: ${resetUrl}` };\n            }\n\n            console.log(`[Reset Password] ğŸ“§ Email sent to ${email} via Resend.`);\n            return { success: true, message: 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å†è¨­å®šç”¨ã®ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚' };\n        } catch (error) {\n            console.error('[Reset Password] âŒ Failed to send email via Resend (Exception):', error);\n            // In dev/debug\n            console.log(`[Reset Password] ğŸ§ª DEV MODE: Reset URL is ${resetUrl}`);\n            return { success: true, message: 'ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚(Dev: ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèª)' };\n        }\n    } else {\n        console.log(`[Reset Password] âš ï¸ No Resend API Key. DEV MODE: Reset URL is ${resetUrl}`);\n        return { success: true, message: 'é€ä¿¡ã—ã¾ã—ãŸ(Dev: ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„)' };\n    }\n}\n\n// 2. Reset Password\nexport async function resetPasswordAction(formData: FormData) {\n    const token = formData.get('token') as string;\n    const password = formData.get('password') as string;\n\n    if (!token || !password) {\n        return { success: false, message: 'ç„¡åŠ¹ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã™ã€‚' };\n    }\n\n    const users = getUsers();\n    const userIndex = users.findIndex((u: any) => u.resetToken === token);\n    const user = users[userIndex];\n\n    if (!user) {\n        return { success: false, message: 'ç„¡åŠ¹ãªã¾ãŸã¯æœŸé™åˆ‡ã‚Œã®ãƒªãƒ³ã‚¯ã§ã™ã€‚' };\n    }\n\n    // Check expiry\n    if (user.resetTokenExpiry && user.resetTokenExpiry < Date.now()) {\n        return { success: false, message: 'ãƒªãƒ³ã‚¯ã®æœ‰åŠ¹æœŸé™ãŒåˆ‡ã‚Œã¦ã„ã¾ã™ã€‚ã‚‚ã†ä¸€åº¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã¦ãã ã•ã„ã€‚' };\n    }\n\n    // Update Password\n    user.password = password;\n    // Clear token\n    delete user.resetToken;\n    delete user.resetTokenExpiry;\n\n    users[userIndex] = user;\n    saveUsers(users);\n\n    return { success: true, message: 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ã¾ã—ãŸã€‚ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚' };\n}\n","export {resetPasswordAction as '406d50826d0311f4a2ba4016d0c87eb0c801506ec1'} from 'ACTIONS_MODULE0'\n"],"names":["registerServerReference","ensureServerEntryExports","actions","i","length","action","Error"],"mappings":"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","ignoreList":[0,1,2,3,4,5,6,7]}