{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///Users/fujinoyouichi/music-studio-app/src/actions/reset-password.ts"],"sourcesContent":["\"use server\";\n\nimport fs from 'fs';\nimport path from 'path';\nimport { v4 as uuidv4 } from 'uuid';\nimport { Resend } from 'resend';\n\nconst USERS_DB_PATH = path.join(process.cwd(), 'data', 'users.json');\nconst resend = new Resend(process.env.RESEND_API_KEY);\n\n// Helper functions\nconst getUsers = (): any[] => {\n    if (!fs.existsSync(USERS_DB_PATH)) return [];\n    try {\n        const data = fs.readFileSync(USERS_DB_PATH, 'utf-8');\n        return JSON.parse(data);\n    } catch {\n        return [];\n    }\n}\n\nconst saveUsers = (users: any[]) => {\n    fs.writeFileSync(USERS_DB_PATH, JSON.stringify(users, null, 2));\n}\n\n// 1. Send Password Reset Email\nexport async function sendPasswordResetAction(formData: FormData) {\n    const email = formData.get('email') as string;\n\n    if (!email) {\n        return { success: false, message: 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚' };\n    }\n\n    const users = getUsers();\n    const userIndex = users.findIndex((u: any) => u.email === email);\n    const user = users[userIndex];\n\n    if (!user) {\n        return { success: false, message: 'ã“ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚' };\n    }\n\n    // Generate Token\n    const resetToken = uuidv4();\n    const resetTokenExpiry = Date.now() + 3600000; // 1 hour from now\n\n    // Save Token to User\n    user.resetToken = resetToken;\n    user.resetTokenExpiry = resetTokenExpiry;\n    users[userIndex] = user;\n    saveUsers(users);\n\n    // Send Email\n    const baseUrl = process.env.NEXT_PUBLIC_BASE_URL || 'http://localhost:3000';\n    const resetUrl = `${baseUrl}/reset-password?token=${resetToken}`;\n\n    if (process.env.RESEND_API_KEY) {\n        try {\n            const { error } = await resend.emails.send({\n                from: 'Studi-Go <onboarding@resend.dev>',\n                to: email,\n                subject: 'ã€Studi-Goã€‘ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å†è¨­å®šã®ã”æ¡ˆå†…',\n                html: `\n                    <h1>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å†è¨­å®š</h1>\n                    <p>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å†è¨­å®šãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸã€‚</p>\n                    <p>ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚</p>\n                    <p><a href=\"${resetUrl}\">${resetUrl}</a></p>\n                    <p>ã“ã®ãƒªãƒ³ã‚¯ã¯1æ™‚é–“æœ‰åŠ¹ã§ã™ã€‚</p>\n                    <p>ãŠå¿ƒå½“ãŸã‚ŠãŒãªã„å ´åˆã¯ã€ã“ã®ãƒ¡ãƒ¼ãƒ«ã‚’ç„¡è¦–ã—ã¦ãã ã•ã„ã€‚</p>\n                `\n            });\n\n            if (error) {\n                console.error('[Reset Password] âŒ Resend Error (Returned):', error);\n                console.log(`[Reset Password] âš ï¸ Email failed. DEV MODE: Reset URL is ${resetUrl}`);\n                // For development convenience, return success with the link if email fails\n                return { success: true, message: `(é–‹ç™ºãƒ¢ãƒ¼ãƒ‰) ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸãŒã€ãƒªã‚»ãƒƒãƒˆURLã‚’ç™ºè¡Œã—ã¾ã—ãŸ: ${resetUrl}` };\n            }\n\n            console.log(`[Reset Password] ğŸ“§ Email sent to ${email} via Resend.`);\n            return { success: true, message: 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å†è¨­å®šç”¨ã®ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚' };\n        } catch (error) {\n            console.error('[Reset Password] âŒ Failed to send email via Resend (Exception):', error);\n            // In dev/debug\n            console.log(`[Reset Password] ğŸ§ª DEV MODE: Reset URL is ${resetUrl}`);\n            return { success: true, message: 'ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚(Dev: ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèª)' };\n        }\n    } else {\n        console.log(`[Reset Password] âš ï¸ No Resend API Key. DEV MODE: Reset URL is ${resetUrl}`);\n        return { success: true, message: 'é€ä¿¡ã—ã¾ã—ãŸ(Dev: ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„)' };\n    }\n}\n\n// 2. Reset Password\nexport async function resetPasswordAction(formData: FormData) {\n    const token = formData.get('token') as string;\n    const password = formData.get('password') as string;\n\n    if (!token || !password) {\n        return { success: false, message: 'ç„¡åŠ¹ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã™ã€‚' };\n    }\n\n    const users = getUsers();\n    const userIndex = users.findIndex((u: any) => u.resetToken === token);\n    const user = users[userIndex];\n\n    if (!user) {\n        return { success: false, message: 'ç„¡åŠ¹ãªã¾ãŸã¯æœŸé™åˆ‡ã‚Œã®ãƒªãƒ³ã‚¯ã§ã™ã€‚' };\n    }\n\n    // Check expiry\n    if (user.resetTokenExpiry && user.resetTokenExpiry < Date.now()) {\n        return { success: false, message: 'ãƒªãƒ³ã‚¯ã®æœ‰åŠ¹æœŸé™ãŒåˆ‡ã‚Œã¦ã„ã¾ã™ã€‚ã‚‚ã†ä¸€åº¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã¦ãã ã•ã„ã€‚' };\n    }\n\n    // Update Password\n    user.password = password;\n    // Clear token\n    delete user.resetToken;\n    delete user.resetTokenExpiry;\n\n    users[userIndex] = user;\n    saveUsers(users);\n\n    return { success: true, message: 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ã¾ã—ãŸã€‚ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚' };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 170, "column": 0}, "map": {"version":3,"sources":["file:///Users/fujinoyouichi/music-studio-app/.next-internal/server/app/forgot-password/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {sendPasswordResetAction as '40db2dc8ace2843fdbdfb90551bbe8fb6738fc43e0'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}