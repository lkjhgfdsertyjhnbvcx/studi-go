{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///Users/fujinoyouichi/music-studio-app/src/lib/db-studio.ts"],"sourcesContent":["import fs from 'fs';\nimport path from 'path';\nimport { v4 as uuidv4 } from 'uuid';\n\nconst STUDIO_DB_PATH = path.join(process.cwd(), 'data', 'studios.json');\n\n// --- Types ---\nexport interface TimeSlotPrice {\n    start: string;\n    end: string;\n    price: number;\n    pricingType?: 'fixed' | 'discount';\n    discountRate?: number; // Percentage (e.g., 20 for 20% off)\n}\nexport interface DaySchedule {\n    slots: TimeSlotPrice[];\n}\nexport interface RoomPricing {\n    weekday: DaySchedule;\n    saturday: DaySchedule;\n    sundayHoliday: DaySchedule;\n}\nexport interface Room {\n    id: string; // generated uuid or simple ID\n    name: string;\n    description?: string;\n    images?: string[];\n    basePrice: number;\n    pricing: RoomPricing;\n}\nexport interface EquipmentOption {\n    name: string;\n    pricePerHour: number;\n}\nexport interface BusinessHours {\n    weekday: string;\n    saturday: string;\n    sundayHoliday: string;\n}\nexport interface StaffMember {\n    id: string;\n    name: string;\n    email: string;\n    password?: string;\n    role: 'admin' | 'staff';\n    createdAt: string;\n}\n\nexport interface BlacklistEntry {\n    userId: string;\n    userName: string;\n    email?: string;\n    reason: string;\n    createdAt: string;\n}\n\nexport interface PersonalPracticeSettings {\n    enabled: boolean;\n    reservationWindowType: 'hours' | 'days';\n    reservationWindowValue: number;\n    maxPeople: number;\n}\n\nexport interface DesignSettings {\n    logoSize: number; // percentage\n    backgroundColor: string;\n    backgroundImageUrl?: string;\n    backgroundType: 'color' | 'image';\n}\n\nexport interface StudioProfile {\n    id: string; // UUID\n    storeName: string;\n    companyName?: string;\n    representative: string;\n    representativeEmail?: string;\n    manager: string; // 担当者名 (or using contactPerson)\n    contactPerson: string;\n    contactPersonEmail?: string;\n    postalCode?: string;\n    address: string;\n    phone: string;\n    email: string; // 店舗全体メール\n    businessHours: BusinessHours;\n    url: string;\n    studioCount: number;\n    rooms: Room[];\n    equipmentOptions: EquipmentOption[];\n    options?: string;\n    images?: string[]; // Array of image URLs or base64\n    appealPoint?: string; // Marketing text\n    monthlyRevenueTarget?: number; // Target for Analytics\n    logoUrl?: string; // Studio Logo\n    invoiceNumber?: string; // Qualified Invoice Issuer Number (T-number)\n    staff?: StaffMember[];\n    blacklist?: BlacklistEntry[];\n    studentDiscount?: {\n        enabled: boolean;\n        discountType: 'amount' | 'percentage';\n        value: number;\n    };\n    otherDiscounts?: Array<{\n        name: string;\n        enabled: boolean;\n        discountType: 'amount' | 'percentage';\n        value: number;\n    }>;\n    personalPracticeSettings?: PersonalPracticeSettings;\n    designSettings?: DesignSettings;\n    createdAt: string;\n}\n\n// Initialize Studio DB as Array\nif (!fs.existsSync(STUDIO_DB_PATH)) {\n    fs.writeFileSync(STUDIO_DB_PATH, JSON.stringify([], null, 2));\n}\n\n// --- Helpers ---\n\nexport const getAllStudios = (): StudioProfile[] => {\n    try {\n        const data = fs.readFileSync(STUDIO_DB_PATH, 'utf-8');\n        return JSON.parse(data);\n    } catch (error) {\n        return [];\n    }\n};\n\nexport const getStudioById = (id: string): StudioProfile | null => {\n    const studios = getAllStudios();\n    return studios.find(s => s.id === id) || null;\n};\n\nexport const saveStudio = (profile: StudioProfile): void => {\n    const studios = getAllStudios();\n    const index = studios.findIndex(s => s.id === profile.id);\n\n    if (index >= 0) {\n        studios[index] = profile;\n    } else {\n        studios.push(profile);\n    }\n\n    fs.writeFileSync(STUDIO_DB_PATH, JSON.stringify(studios, null, 2));\n};\n\nexport const deleteStudio = (id: string): void => {\n    const studios = getAllStudios().filter(s => s.id !== id);\n    fs.writeFileSync(STUDIO_DB_PATH, JSON.stringify(studios, null, 2));\n}\n\nexport const createEmptyStudio = (): StudioProfile => {\n    return {\n        id: uuidv4(),\n        storeName: \"New Studio\",\n        representative: \"\",\n        manager: \"\",\n        contactPerson: \"\",\n        address: \"\",\n        phone: \"\",\n        email: \"\",\n        businessHours: { weekday: \"10:00-22:00\", saturday: \"10:00-22:00\", sundayHoliday: \"10:00-22:00\" },\n        url: \"\",\n        studioCount: 0,\n        rooms: [],\n        studentDiscount: { enabled: false, discountType: 'amount', value: 0 },\n        otherDiscounts: [],\n        personalPracticeSettings: { enabled: true, reservationWindowType: 'days', reservationWindowValue: 1, maxPeople: 2 },\n        designSettings: { logoSize: 100, backgroundColor: \"#000000\", backgroundType: 'color' },\n        equipmentOptions: [],\n        createdAt: new Date().toISOString()\n    };\n};\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;AACA;AACA;;;;AAEA,MAAM,iBAAiB,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,QAAQ;AA4GxD,gCAAgC;AAChC,IAAI,CAAC,wGAAE,CAAC,UAAU,CAAC,iBAAiB;IAChC,wGAAE,CAAC,aAAa,CAAC,gBAAgB,KAAK,SAAS,CAAC,EAAE,EAAE,MAAM;AAC9D;AAIO,MAAM,gBAAgB;IACzB,IAAI;QACA,MAAM,OAAO,wGAAE,CAAC,YAAY,CAAC,gBAAgB;QAC7C,OAAO,KAAK,KAAK,CAAC;IACtB,EAAE,OAAO,OAAO;QACZ,OAAO,EAAE;IACb;AACJ;AAEO,MAAM,gBAAgB,CAAC;IAC1B,MAAM,UAAU;IAChB,OAAO,QAAQ,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,OAAO;AAC7C;AAEO,MAAM,aAAa,CAAC;IACvB,MAAM,UAAU;IAChB,MAAM,QAAQ,QAAQ,SAAS,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,QAAQ,EAAE;IAExD,IAAI,SAAS,GAAG;QACZ,OAAO,CAAC,MAAM,GAAG;IACrB,OAAO;QACH,QAAQ,IAAI,CAAC;IACjB;IAEA,wGAAE,CAAC,aAAa,CAAC,gBAAgB,KAAK,SAAS,CAAC,SAAS,MAAM;AACnE;AAEO,MAAM,eAAe,CAAC;IACzB,MAAM,UAAU,gBAAgB,MAAM,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;IACrD,wGAAE,CAAC,aAAa,CAAC,gBAAgB,KAAK,SAAS,CAAC,SAAS,MAAM;AACnE;AAEO,MAAM,oBAAoB;IAC7B,OAAO;QACH,IAAI,IAAA,2MAAM;QACV,WAAW;QACX,gBAAgB;QAChB,SAAS;QACT,eAAe;QACf,SAAS;QACT,OAAO;QACP,OAAO;QACP,eAAe;YAAE,SAAS;YAAe,UAAU;YAAe,eAAe;QAAc;QAC/F,KAAK;QACL,aAAa;QACb,OAAO,EAAE;QACT,iBAAiB;YAAE,SAAS;YAAO,cAAc;YAAU,OAAO;QAAE;QACpE,gBAAgB,EAAE;QAClB,0BAA0B;YAAE,SAAS;YAAM,uBAAuB;YAAQ,wBAAwB;YAAG,WAAW;QAAE;QAClH,gBAAgB;YAAE,UAAU;YAAK,iBAAiB;YAAW,gBAAgB;QAAQ;QACrF,kBAAkB,EAAE;QACpB,WAAW,IAAI,OAAO,WAAW;IACrC;AACJ"}},
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["file:///Users/fujinoyouichi/music-studio-app/src/actions/admin-auth.ts"],"sourcesContent":["\"use server\";\n\nimport { cookies } from 'next/headers';\nimport { redirect } from 'next/navigation';\nimport { getAllStudios } from '@/lib/db-studio';\n\nconst ADMIN_CREDENTIALS = {\n    email: \"admin@antigravity.com\",\n    password: \"admin\"\n};\n\nexport async function adminLogin(formData: FormData, isPlatformLogin: boolean = false) {\n    const email = formData.get('email') as string;\n    const password = formData.get('password') as string;\n\n    // 1. Platform Admin Login (Strict Mode)\n    if (isPlatformLogin) {\n        if (email === ADMIN_CREDENTIALS.email && password === ADMIN_CREDENTIALS.password) {\n            const cookieStore = await cookies();\n            const oneDay = 24 * 60 * 60 * 1000;\n            cookieStore.set('admin_token', 'authenticated_admin_token_secure_v1', {\n                httpOnly: true,\n                path: '/',\n                expires: Date.now() + oneDay\n            });\n            return { success: true };\n        }\n        return { success: false, message: \"運営管理者IDまたはパスワードが正しくありません。\" };\n    }\n\n    // 2. Studio Accounts Login (Default)\n    const studios = getAllStudios();\n\n    // Check main studio email\n    const studio = studios.find(s => s.email === email);\n    if (studio) {\n        // For simplicity, we use 'admin' as default password for studio main accounts for now\n        // In a real app, this would be a hashed password in the DB\n        if (password === 'admin') {\n            await storeLogin(studio.id);\n            return { success: true };\n        }\n    }\n\n    // Check staff accounts\n    for (const s of studios) {\n        const staffMember = s.staff?.find(sm => sm.email === email && sm.password === password);\n        if (staffMember) {\n            await storeLogin(s.id);\n            return { success: true };\n        }\n    }\n\n    return { success: false, message: \"店舗IDまたはパスワードが正しくありません。\" };\n}\n\nexport async function storeLogin(studioId: string) {\n    const cookieStore = await cookies();\n    const oneDay = 24 * 60 * 60 * 1000;\n    cookieStore.set('studio_token', studioId, {\n        httpOnly: true,\n        path: '/',\n        expires: Date.now() + oneDay\n    });\n    return { success: true };\n}\n\nexport async function adminLogout() {\n    const cookieStore = await cookies();\n    cookieStore.delete('admin_token');\n    cookieStore.delete('studio_token');\n    redirect('/admin/login');\n}\n\nexport async function getAuthInfo() {\n    const cookieStore = await cookies();\n    const adminToken = cookieStore.get('admin_token');\n    const studioToken = cookieStore.get('studio_token');\n\n    return {\n        isAdmin: !!adminToken,\n        studioId: studioToken?.value || null\n    };\n}\n\nexport async function checkAdminAuth() {\n    const auth = await getAuthInfo();\n    return auth.isAdmin || !!auth.studioId;\n}\n\nexport async function requireAdminAuth() {\n    const isAuth = await checkAdminAuth();\n    if (!isAuth) {\n        redirect('/admin/login');\n    }\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;AAEA;AACA;AAAA;AACA;;;;;;AAEA,MAAM,oBAAoB;IACtB,OAAO;IACP,UAAU;AACd;AAEO,eAAe,WAAW,QAAkB,EAAE,kBAA2B,KAAK;IACjF,MAAM,QAAQ,SAAS,GAAG,CAAC;IAC3B,MAAM,WAAW,SAAS,GAAG,CAAC;IAE9B,wCAAwC;IACxC,IAAI,iBAAiB;QACjB,IAAI,UAAU,kBAAkB,KAAK,IAAI,aAAa,kBAAkB,QAAQ,EAAE;YAC9E,MAAM,cAAc,MAAM,IAAA,oKAAO;YACjC,MAAM,SAAS,KAAK,KAAK,KAAK;YAC9B,YAAY,GAAG,CAAC,eAAe,uCAAuC;gBAClE,UAAU;gBACV,MAAM;gBACN,SAAS,KAAK,GAAG,KAAK;YAC1B;YACA,OAAO;gBAAE,SAAS;YAAK;QAC3B;QACA,OAAO;YAAE,SAAS;YAAO,SAAS;QAA4B;IAClE;IAEA,qCAAqC;IACrC,MAAM,UAAU,IAAA,qKAAa;IAE7B,0BAA0B;IAC1B,MAAM,SAAS,QAAQ,IAAI,CAAC,CAAA,IAAK,EAAE,KAAK,KAAK;IAC7C,IAAI,QAAQ;QACR,sFAAsF;QACtF,2DAA2D;QAC3D,IAAI,aAAa,SAAS;YACtB,MAAM,WAAW,OAAO,EAAE;YAC1B,OAAO;gBAAE,SAAS;YAAK;QAC3B;IACJ;IAEA,uBAAuB;IACvB,KAAK,MAAM,KAAK,QAAS;QACrB,MAAM,cAAc,EAAE,KAAK,EAAE,KAAK,CAAA,KAAM,GAAG,KAAK,KAAK,SAAS,GAAG,QAAQ,KAAK;QAC9E,IAAI,aAAa;YACb,MAAM,WAAW,EAAE,EAAE;YACrB,OAAO;gBAAE,SAAS;YAAK;QAC3B;IACJ;IAEA,OAAO;QAAE,SAAS;QAAO,SAAS;IAAyB;AAC/D;AAEO,eAAe,WAAW,QAAgB;IAC7C,MAAM,cAAc,MAAM,IAAA,oKAAO;IACjC,MAAM,SAAS,KAAK,KAAK,KAAK;IAC9B,YAAY,GAAG,CAAC,gBAAgB,UAAU;QACtC,UAAU;QACV,MAAM;QACN,SAAS,KAAK,GAAG,KAAK;IAC1B;IACA,OAAO;QAAE,SAAS;IAAK;AAC3B;AAEO,eAAe;IAClB,MAAM,cAAc,MAAM,IAAA,oKAAO;IACjC,YAAY,MAAM,CAAC;IACnB,YAAY,MAAM,CAAC;IACnB,IAAA,2NAAQ,EAAC;AACb;AAEO,eAAe;IAClB,MAAM,cAAc,MAAM,IAAA,oKAAO;IACjC,MAAM,aAAa,YAAY,GAAG,CAAC;IACnC,MAAM,cAAc,YAAY,GAAG,CAAC;IAEpC,OAAO;QACH,SAAS,CAAC,CAAC;QACX,UAAU,aAAa,SAAS;IACpC;AACJ;AAEO,eAAe;IAClB,MAAM,OAAO,MAAM;IACnB,OAAO,KAAK,OAAO,IAAI,CAAC,CAAC,KAAK,QAAQ;AAC1C;AAEO,eAAe;IAClB,MAAM,SAAS,MAAM;IACrB,IAAI,CAAC,QAAQ;QACT,IAAA,2NAAQ,EAAC;IACb;AACJ;;;IApFsB;IA6CA;IAWA;IAOA;IAWA;IAKA;;AA/EA,yQAAA;AA6CA,yQAAA;AAWA,yQAAA;AAOA,yQAAA;AAWA,yQAAA;AAKA,yQAAA"}},
    {"offset": {"line": 243, "column": 0}, "map": {"version":3,"sources":["file:///Users/fujinoyouichi/music-studio-app/.next-internal/server/app/admin/login/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {adminLogin as '6095d9b95f263e7a67fcaf6220fc022a92ad42b253'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}