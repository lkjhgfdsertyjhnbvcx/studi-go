{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/fujinoyouichi/music-studio-app/src/actions/studio.ts"],"sourcesContent":["\"use server\";\n\nimport {\n    StudioProfile,\n    getAllStudios,\n    getStudioById,\n    saveStudio,\n    createEmptyStudio,\n    deleteStudio\n} from \"@/lib/db-studio\";\nimport { revalidatePath } from \"next/cache\";\n\n// Get All\nexport async function fetchStudios() {\n    return getAllStudios();\n}\n\n// Get One\nexport async function fetchStudio(id: string) {\n    return getStudioById(id);\n}\n\n// Upsert\nexport async function updateStudio(data: StudioProfile) {\n    try {\n        saveStudio(data);\n        revalidatePath(\"/studios\");\n        revalidatePath(`/studios/${data.id}`);\n        return { success: true, message: \"Studio saved successfully.\" };\n    } catch (e: any) {\n        return { success: false, message: e.message };\n    }\n}\n\n// Create New\nexport async function createNewStudioAction() {\n    const newStudio = createEmptyStudio();\n    saveStudio(newStudio);\n    revalidatePath(\"/studios\");\n    return newStudio.id;\n}\n\n// Delete\nexport async function deleteStudioAction(id: string) {\n    deleteStudio(id);\n    revalidatePath(\"/studios\");\n    return { success: true };\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;AAEA;AAQA;;;;;AAGO,eAAe;IAClB,OAAO,IAAA,qKAAa;AACxB;AAGO,eAAe,YAAY,EAAU;IACxC,OAAO,IAAA,qKAAa,EAAC;AACzB;AAGO,eAAe,aAAa,IAAmB;IAClD,IAAI;QACA,IAAA,kKAAU,EAAC;QACX,IAAA,yKAAc,EAAC;QACf,IAAA,yKAAc,EAAC,CAAC,SAAS,EAAE,KAAK,EAAE,EAAE;QACpC,OAAO;YAAE,SAAS;YAAM,SAAS;QAA6B;IAClE,EAAE,OAAO,GAAQ;QACb,OAAO;YAAE,SAAS;YAAO,SAAS,EAAE,OAAO;QAAC;IAChD;AACJ;AAGO,eAAe;IAClB,MAAM,YAAY,IAAA,yKAAiB;IACnC,IAAA,kKAAU,EAAC;IACX,IAAA,yKAAc,EAAC;IACf,OAAO,UAAU,EAAE;AACvB;AAGO,eAAe,mBAAmB,EAAU;IAC/C,IAAA,oKAAY,EAAC;IACb,IAAA,yKAAc,EAAC;IACf,OAAO;QAAE,SAAS;IAAK;AAC3B;;;IAlCsB;IAKA;IAKA;IAYA;IAQA;;AA9BA,yQAAA;AAKA,yQAAA;AAKA,yQAAA;AAYA,yQAAA;AAQA,yQAAA"}},
    {"offset": {"line": 75, "column": 0}, "map": {"version":3,"sources":["file:///Users/fujinoyouichi/music-studio-app/src/actions/payment.ts"],"sourcesContent":["\"use server\";\n\nimport fs from \"fs\";\nimport path from \"path\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport { getAuthInfo } from \"./admin-auth\";\nimport { revalidatePath, unstable_noStore as noStore } from \"next/cache\";\n\n// Resolve DB path dynamically to avoid any process.cwd issues\nconst getDbPath = () => path.join(process.cwd(), \"data\", \"payments.json\");\n\nexport interface Payment {\n    id: string;\n    bookingId: string;\n    studioId: string;\n    studioName: string;\n    userName: string;\n    userEmail: string;\n    userPhone?: string;\n    amount: number;\n    status: \"paid\" | \"pending\" | \"failed\";\n    paymentMethod: \"stripe\" | \"credit\" | \"other\" | \"bank_transfer\";\n    date: string;\n    dueDate?: string;\n    createdAt: string;\n}\n\n// Internal helper to read data with no-cache\nasync function _getAllPayments(): Promise<Payment[]> {\n    noStore();\n    const dbPath = getDbPath();\n    try {\n        if (!fs.existsSync(dbPath)) return [];\n        const data = fs.readFileSync(dbPath, \"utf-8\");\n        return JSON.parse(data);\n    } catch (error) {\n        console.error(\"[PaymentDB] Read error:\", error);\n        return [];\n    }\n}\n\nexport async function fetchPayments(): Promise<Payment[]> {\n    const auth = await getAuthInfo();\n    const payments = await _getAllPayments();\n\n    if (auth.isAdmin) return payments;\n    if (auth.studioId) return payments.filter(p => p.studioId === auth.studioId);\n    return [];\n}\n\nexport async function sendReminderEmail(paymentId: string, email: string) {\n    console.log(`[Email] Reminder to ${email} for ${paymentId}`);\n    await new Promise(r => setTimeout(r, 500));\n    return { success: true };\n}\n\nexport async function createPayment(data: any) {\n    const payments = await _getAllPayments();\n    const newPayment: Payment = {\n        id: uuidv4(),\n        ...data,\n        status: \"pending\",\n        date: new Date().toISOString().split(\"T\")[0],\n        dueDate: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000).toISOString().split(\"T\")[0],\n        createdAt: new Date().toISOString(),\n    };\n    payments.push(newPayment);\n    fs.writeFileSync(getDbPath(), JSON.stringify(payments, null, 2), \"utf-8\");\n    revalidatePath(\"/admin/payments\");\n    return { success: true, paymentId: newPayment.id };\n}\n\nexport async function updatePaymentStatus(paymentId: string, status: \"paid\" | \"pending\" | \"failed\") {\n    noStore();\n    console.log(`[ServerAction] Reconciling payment: ${paymentId} -> ${status}`);\n\n    try {\n        const dbPath = getDbPath();\n        const data = fs.readFileSync(dbPath, \"utf-8\");\n        const payments: Payment[] = JSON.parse(data);\n\n        const index = payments.findIndex(p => p.id === paymentId);\n        if (index === -1) {\n            return { success: false, message: \"対象データが見つかりませんでした。\" };\n        }\n\n        payments[index].status = status;\n\n        // Write synchronously to ensure it's done before returning\n        fs.writeFileSync(dbPath, JSON.stringify(payments, null, 2), \"utf-8\");\n\n        // Force Next.js to purge any cached versions of pages using this data\n        revalidatePath(\"/admin/payments\");\n        revalidatePath(\"/admin\");\n        revalidatePath(\"/\", \"layout\"); // Global revalidation for safety\n\n        return { success: true };\n    } catch (error: any) {\n        console.error(\"[ServerAction] Reconcile error:\", error);\n        return { success: false, message: error.message };\n    }\n}\n\nexport async function handleStripeWebhook(payload: any) {\n    console.log(\"Stripe Hook:\", payload.type);\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 199, "column": 0}, "map": {"version":3,"sources":["file:///Users/fujinoyouichi/music-studio-app/.next-internal/server/app/admin/%28protected%29/payments/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {adminLogout as '001204c5cf63a9b2296f854320112c5a87dcce6e42'} from 'ACTIONS_MODULE0'\nexport {checkAdminAuth as '00437f65ee5b42f956e8ffc66d1cb8f078eb3f7b8f'} from 'ACTIONS_MODULE0'\nexport {getAuthInfo as '0094447a595c8804f1bc342263046c499a9212ef70'} from 'ACTIONS_MODULE0'\nexport {requireAdminAuth as '00fad050e5d6ad0ce3b05eee5af53765577db154bf'} from 'ACTIONS_MODULE0'\nexport {storeLogin as '40f94cb5b752928b50e639d0b94db41445b719e91b'} from 'ACTIONS_MODULE0'\nexport {adminLogin as '6095d9b95f263e7a67fcaf6220fc022a92ad42b253'} from 'ACTIONS_MODULE0'\nexport {adminLogout as '001204c5cf63a9b2296f854320112c5a87dcce6e42'} from 'ACTIONS_MODULE0'\nexport {getAuthInfo as '0094447a595c8804f1bc342263046c499a9212ef70'} from 'ACTIONS_MODULE0'\nexport {fetchStudios as '00de754591fdaf2c4a04b598d8d123785d38cd283a'} from 'ACTIONS_MODULE1'\nexport {fetchStudio as '405932c62487fb452c306955850c3372e60cb81894'} from 'ACTIONS_MODULE1'\nexport {updateStudio as '40a99c7e57f5ffb60c7126b179428ff9a0895705a5'} from 'ACTIONS_MODULE1'\nexport {createNewStudioAction as '00074318368149362b438db185274ca5ef282e82ea'} from 'ACTIONS_MODULE1'\nexport {deleteStudioAction as '40f0b91f465b26951c09a3f17715c967e1276cad01'} from 'ACTIONS_MODULE1'\nexport {fetchPayments as '004a8f84a38d929aa460ab16ac81f6e601fc034e64'} from 'ACTIONS_MODULE2'\nexport {createPayment as '40bffadceace1d14125374fa175a685e1f9b642392'} from 'ACTIONS_MODULE2'\nexport {handleStripeWebhook as '40e86fa2e7233e1269d9d424259db5fa5ebdd149a8'} from 'ACTIONS_MODULE2'\nexport {sendReminderEmail as '607fa2839eb98bb74557caadff25fd2d87abb38882'} from 'ACTIONS_MODULE2'\nexport {updatePaymentStatus as '60dbf550afa83d3dab038e335df44bdff8b55344c9'} from 'ACTIONS_MODULE2'\nexport {sendReminderEmail as '607fa2839eb98bb74557caadff25fd2d87abb38882'} from 'ACTIONS_MODULE2'\nexport {updatePaymentStatus as '60dbf550afa83d3dab038e335df44bdff8b55344c9'} from 'ACTIONS_MODULE2'\n"],"names":[],"mappings":";AAAA;AAQA;AAKA"}}]
}