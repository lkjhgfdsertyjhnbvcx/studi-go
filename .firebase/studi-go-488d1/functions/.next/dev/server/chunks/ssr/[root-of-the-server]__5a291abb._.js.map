{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 88, "column": 0}, "map": {"version":3,"sources":["file:///Users/fujinoyouichi/music-studio-app/src/lib/firebase.ts"],"sourcesContent":["import { initializeApp, getApps, getApp } from \"firebase/app\";\nimport { getFirestore } from \"firebase/firestore\";\n\nconst firebaseConfig = {\n    apiKey: process.env.NEXT_PUBLIC_FIREBASE_API_KEY,\n    authDomain: process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,\n    projectId: process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,\n    storageBucket: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,\n    messagingSenderId: process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,\n    appId: process.env.NEXT_PUBLIC_FIREBASE_APP_ID,\n    measurementId: process.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID,\n};\n\n// Initialize Firebase (Singleton pattern)\nconst app = getApps().length > 0 ? getApp() : initializeApp(firebaseConfig);\nconst db = getFirestore(app);\n\nexport { db };\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;AAAA;;;AAEA,MAAM,iBAAiB;IACnB,MAAM;IACN,UAAU;IACV,SAAS;IACT,aAAa;IACb,iBAAiB;IACjB,KAAK;IACL,aAAa;AACjB;AAEA,0CAA0C;AAC1C,MAAM,MAAM,IAAA,qMAAO,IAAG,MAAM,GAAG,IAAI,IAAA,oMAAM,MAAK,IAAA,2MAAa,EAAC;AAC5D,MAAM,KAAK,IAAA,2MAAY,EAAC"}},
    {"offset": {"line": 115, "column": 0}, "map": {"version":3,"sources":["file:///Users/fujinoyouichi/music-studio-app/src/lib/db-firestore.ts"],"sourcesContent":["import { db } from \"./firebase\";\nimport {\n    collection,\n    doc,\n    getDocs,\n    getDoc,\n    setDoc,\n    updateDoc,\n    deleteDoc,\n    query,\n    where,\n    Timestamp\n} from \"firebase/firestore\";\nimport { StudioProfile } from \"./db-studio\";\nimport { User } from \"@/actions/auth\";\nimport { Booking } from \"./db-local\";\nimport { Payment } from \"@/actions/payment\";\n\nexport interface Campaign {\n    id: string;\n    title: string;\n    description: string;\n    discountType: \"percentage\" | \"fixed\";\n    discountValue: number;\n    target: \"all\" | \"specific\";\n    targetStudioIds: string[];\n    startDate: string;\n    endDate: string;\n    isActive: boolean;\n    createdAt: string;\n}\n\nexport interface Coupon {\n    id: string;\n    code: string;\n    title: string;\n    discountType: \"percentage\" | \"fixed\";\n    discountValue: number;\n    maxUses: number;\n    usedCount: number;\n    validFrom: string;\n    validUntil: string;\n    targetStudioIds: string[];\n    isActive: boolean;\n    createdAt: string;\n}\n\n// --- STUDIOS ---\nexport const getAllStudiosFromFirestore = async (): Promise<StudioProfile[]> => {\n    try {\n        const snapshot = await getDocs(collection(db, \"studios\"));\n        return snapshot.docs.map(doc => doc.data() as StudioProfile);\n    } catch (e) {\n        console.error(\"Error fetching studios:\", e);\n        return [];\n    }\n};\n\nexport const getStudioByIdFromFirestore = async (id: string): Promise<StudioProfile | null> => {\n    try {\n        const docRef = doc(db, \"studios\", id);\n        const docSnap = await getDoc(docRef);\n        return docSnap.exists() ? (docSnap.data() as StudioProfile) : null;\n    } catch (e) {\n        console.error(\"Error fetching studio:\", e);\n        return null;\n    }\n};\n\nexport const saveStudioToFirestore = async (studio: StudioProfile): Promise<void> => {\n    try {\n        await setDoc(doc(db, \"studios\", studio.id), studio);\n    } catch (e) {\n        console.error(\"Error saving studio:\", e);\n        throw e;\n    }\n};\n\nexport const deleteStudioFromFirestore = async (id: string): Promise<void> => {\n    try {\n        await deleteDoc(doc(db, \"studios\", id));\n    } catch (e) {\n        console.error(\"Error deleting studio:\", e);\n        throw e;\n    }\n};\n\n// --- USERS ---\nexport const getAllUsersFromFirestore = async (): Promise<User[]> => {\n    try {\n        const snapshot = await getDocs(collection(db, \"users\"));\n        return snapshot.docs.map(doc => doc.data() as User);\n    } catch (e) {\n        console.error(\"Error fetching users:\", e);\n        return [];\n    }\n};\n\nexport const getUserByIdFromFirestore = async (id: string): Promise<User | undefined> => {\n    try {\n        const docRef = doc(db, \"users\", id);\n        const docSnap = await getDoc(docRef);\n        return docSnap.exists() ? (docSnap.data() as User) : undefined;\n    } catch (e) {\n        console.error(\"Error fetching user:\", e);\n        return undefined;\n    }\n};\n\nexport const saveUserToFirestore = async (user: User): Promise<void> => {\n    try {\n        await setDoc(doc(db, \"users\", user.id), user);\n    } catch (e) {\n        console.error(\"Error saving user:\", e);\n        throw e;\n    }\n};\n\n// --- BOOKINGS ---\nexport const getAllBookingsFromFirestore = async (): Promise<Booking[]> => {\n    try {\n        const snapshot = await getDocs(collection(db, \"bookings\"));\n        return snapshot.docs.map(doc => doc.data() as Booking);\n    } catch (e) {\n        console.error(\"Error fetching bookings:\", e);\n        return [];\n    }\n};\n\nexport const getBookingByIdFromFirestore = async (id: string): Promise<Booking | undefined> => {\n    try {\n        const docRef = doc(db, \"bookings\", id);\n        const docSnap = await getDoc(docRef);\n        return docSnap.exists() ? (docSnap.data() as Booking) : undefined;\n    } catch (e) {\n        console.error(\"Error fetching booking:\", e);\n        return undefined;\n    }\n};\n\nexport const saveBookingToFirestore = async (booking: Booking): Promise<void> => {\n    try {\n        await setDoc(doc(db, \"bookings\", booking.id), booking);\n    } catch (e) {\n        console.error(\"Error saving booking:\", e);\n        throw e;\n    }\n};\n\nexport const updateBookingInFirestore = async (id: string, updates: Partial<Booking>): Promise<boolean> => {\n    try {\n        await updateDoc(doc(db, \"bookings\", id), updates);\n        return true;\n    } catch (e) {\n        console.error(\"Error updating booking:\", e);\n        return false;\n    }\n};\n\n// --- PAYMENTS ---\nexport const getAllPaymentsFromFirestore = async (): Promise<Payment[]> => {\n    try {\n        const snapshot = await getDocs(collection(db, \"payments\"));\n        return snapshot.docs.map(doc => doc.data() as Payment);\n    } catch (e) {\n        console.error(\"Error fetching payments:\", e);\n        return [];\n    }\n};\n\nexport const getPaymentsByStudioIdFromFirestore = async (studioId: string): Promise<Payment[]> => {\n    try {\n        const q = query(collection(db, \"payments\"), where(\"studioId\", \"==\", studioId));\n        const snapshot = await getDocs(q);\n        return snapshot.docs.map(doc => doc.data() as Payment);\n    } catch (e) {\n        console.error(\"Error fetching studio payments:\", e);\n        return [];\n    }\n};\n\nexport const savePaymentToFirestore = async (payment: Payment): Promise<void> => {\n    try {\n        await setDoc(doc(db, \"payments\", payment.id), payment);\n    } catch (e) {\n        console.error(\"Error saving payment:\", e);\n        throw e;\n    }\n};\n\nexport const updatePaymentStatusInFirestore = async (id: string, status: string): Promise<boolean> => {\n    try {\n        await updateDoc(doc(db, \"payments\", id), { status });\n        return true;\n    } catch (e) {\n        console.error(\"Error updating payment status:\", e);\n        return false;\n    }\n};\n\n// --- AVAILABILITY ---\nexport const checkAvailabilityFromFirestore = async (\n    studioId: string,\n    roomName: string | undefined,\n    date: string,\n    startTime: string,\n    duration: number,\n    excludeBookingId?: string\n): Promise<boolean> => {\n    try {\n        const bookings = await getAllBookingsFromFirestore();\n\n        // Convert new request to minutes from midnight\n        const [startH, startM] = startTime.split(':').map(Number);\n        const newStart = startH * 60 + startM;\n        const newEnd = newStart + (duration * 60);\n\n        const conflictingBookings = bookings.filter(b => {\n            if (b.status === 'cancelled') return false;\n            if (excludeBookingId && b.id === excludeBookingId) return false;\n            if (b.date !== date) return false;\n            if (b.studioId !== studioId) return false;\n            if (roomName && b.roomName && b.roomName !== roomName) return false;\n            return true;\n        });\n\n        for (const b of conflictingBookings) {\n            const [h, m] = b.startTime.split(':').map(Number);\n            const bStart = h * 60 + m;\n            const bEnd = bStart + (b.durationHours * 60);\n\n            if (newStart < bEnd && newEnd > bStart) {\n                return false;\n            }\n        }\n        return true;\n    } catch (e) {\n        console.error(\"Error checking availability:\", e);\n        return false;\n    }\n};\n\n// --- CAMPAIGNS ---\nexport const getAllCampaignsFromFirestore = async (): Promise<Campaign[]> => {\n    try {\n        const snapshot = await getDocs(collection(db, \"campaigns\"));\n        return snapshot.docs.map(doc => doc.data() as Campaign);\n    } catch (e) {\n        console.error(\"Error fetching campaigns:\", e);\n        return [];\n    }\n};\n\nexport const saveCampaignToFirestore = async (campaign: Campaign): Promise<void> => {\n    try {\n        await setDoc(doc(db, \"campaigns\", campaign.id), campaign);\n    } catch (e) {\n        console.error(\"Error saving campaign:\", e);\n        throw e;\n    }\n};\n\nexport const deleteCampaignFromFirestore = async (id: string): Promise<void> => {\n    try {\n        await deleteDoc(doc(db, \"campaigns\", id));\n    } catch (e) {\n        console.error(\"Error deleting campaign:\", e);\n        throw e;\n    }\n};\n\n// --- COUPONS ---\nexport const getAllCouponsFromFirestore = async (): Promise<Coupon[]> => {\n    try {\n        const snapshot = await getDocs(collection(db, \"coupons\"));\n        return snapshot.docs.map(doc => doc.data() as Coupon);\n    } catch (e) {\n        console.error(\"Error fetching coupons:\", e);\n        return [];\n    }\n};\n\nexport const saveCouponToFirestore = async (coupon: Coupon): Promise<void> => {\n    try {\n        await setDoc(doc(db, \"coupons\", coupon.id), coupon);\n    } catch (e) {\n        console.error(\"Error saving coupon:\", e);\n        throw e;\n    }\n};\n\nexport const deleteCouponFromFirestore = async (id: string): Promise<void> => {\n    try {\n        await deleteDoc(doc(db, \"coupons\", id));\n    } catch (e) {\n        console.error(\"Error deleting coupon:\", e);\n        throw e;\n    }\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 385, "column": 0}, "map": {"version":3,"sources":["file:///Users/fujinoyouichi/music-studio-app/src/lib/db-studio.ts"],"sourcesContent":["import { v4 as uuidv4 } from 'uuid';\nimport {\n    getAllStudiosFromFirestore,\n    getStudioByIdFromFirestore,\n    saveStudioToFirestore,\n    deleteStudioFromFirestore\n} from './db-firestore';\n\n// --- Types ---\nexport interface TimeSlotPrice {\n    start: string;\n    end: string;\n    price: number;\n    pricingType?: 'fixed' | 'discount';\n    discountRate?: number; // Percentage (e.g., 20 for 20% off)\n}\nexport interface DaySchedule {\n    slots: TimeSlotPrice[];\n}\nexport interface RoomPricing {\n    weekday: DaySchedule;\n    saturday: DaySchedule;\n    sundayHoliday: DaySchedule;\n}\nexport interface Room {\n    id: string; // generated uuid or simple ID\n    name: string;\n    description?: string;\n    images?: string[];\n    basePrice: number;\n    pricing: RoomPricing;\n}\nexport interface EquipmentOption {\n    name: string;\n    pricePerHour: number;\n}\nexport interface BusinessHours {\n    weekday: string;\n    saturday: string;\n    sundayHoliday: string;\n}\nexport interface StaffMember {\n    id: string;\n    name: string;\n    email: string;\n    password?: string;\n    role: 'admin' | 'staff';\n    createdAt: string;\n}\n\nexport interface BlacklistEntry {\n    userId: string;\n    userName: string;\n    email?: string;\n    reason: string;\n    createdAt: string;\n}\n\nexport interface PersonalPracticeSettings {\n    enabled: boolean;\n    reservationWindowType: 'hours' | 'days';\n    reservationWindowValue: number;\n    maxPeople: number;\n}\n\nexport interface DesignSettings {\n    logoSize: number; // percentage\n    backgroundColor: string;\n    backgroundImageUrl?: string;\n    backgroundType: 'color' | 'image';\n}\n\nexport interface StudioProfile {\n    id: string; // UUID\n    storeName: string;\n    companyName?: string;\n    representative: string;\n    representativeEmail?: string;\n    manager: string; // 担当者名 (or using contactPerson)\n    contactPerson: string;\n    contactPersonEmail?: string;\n    postalCode?: string;\n    address: string;\n    phone: string;\n    email: string; // 店舗全体メール\n    businessHours: BusinessHours;\n    url: string;\n    studioCount: number;\n    rooms: Room[];\n    equipmentOptions: EquipmentOption[];\n    options?: string;\n    images?: string[]; // Array of image URLs or base64\n    appealPoint?: string; // Marketing text\n    monthlyRevenueTarget?: number; // Target for Analytics\n    logoUrl?: string; // Studio Logo\n    invoiceNumber?: string; // Qualified Invoice Issuer Number (T-number)\n    staff?: StaffMember[];\n    blacklist?: BlacklistEntry[];\n    studentDiscount?: {\n        enabled: boolean;\n        discountType: 'amount' | 'percentage';\n        value: number;\n    };\n    otherDiscounts?: Array<{\n        name: string;\n        enabled: boolean;\n        discountType: 'amount' | 'percentage';\n        value: number;\n    }>;\n    personalPracticeSettings?: PersonalPracticeSettings;\n    designSettings?: DesignSettings;\n    createdAt: string;\n}\n\n// --- Helpers (Bridging to Firestore) ---\n\nexport const getAllStudios = async (): Promise<StudioProfile[]> => {\n    return getAllStudiosFromFirestore();\n};\n\nexport const getStudioById = async (id: string): Promise<StudioProfile | null> => {\n    return getStudioByIdFromFirestore(id);\n};\n\nexport const saveStudio = async (profile: StudioProfile): Promise<void> => {\n    await saveStudioToFirestore(profile);\n};\n\nexport const deleteStudio = async (id: string): Promise<void> => {\n    await deleteStudioFromFirestore(id);\n}\n\nexport const createEmptyStudio = (): StudioProfile => {\n    return {\n        id: uuidv4(),\n        storeName: \"New Studio\",\n        representative: \"\",\n        manager: \"\",\n        contactPerson: \"\",\n        address: \"\",\n        phone: \"\",\n        email: \"\",\n        businessHours: { weekday: \"10:00-22:00\", saturday: \"10:00-22:00\", sundayHoliday: \"10:00-22:00\" },\n        url: \"\",\n        studioCount: 0,\n        rooms: [],\n        studentDiscount: { enabled: false, discountType: 'amount', value: 0 },\n        otherDiscounts: [],\n        personalPracticeSettings: { enabled: true, reservationWindowType: 'days', reservationWindowValue: 1, maxPeople: 2 },\n        designSettings: { logoSize: 100, backgroundColor: \"#000000\", backgroundType: 'color' },\n        equipmentOptions: [],\n        createdAt: new Date().toISOString()\n    };\n};\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;AACA;;;AAmHO,MAAM,gBAAgB;IACzB,OAAO,IAAA,qLAA0B;AACrC;AAEO,MAAM,gBAAgB,OAAO;IAChC,OAAO,IAAA,qLAA0B,EAAC;AACtC;AAEO,MAAM,aAAa,OAAO;IAC7B,MAAM,IAAA,gLAAqB,EAAC;AAChC;AAEO,MAAM,eAAe,OAAO;IAC/B,MAAM,IAAA,oLAAyB,EAAC;AACpC;AAEO,MAAM,oBAAoB;IAC7B,OAAO;QACH,IAAI,IAAA,2MAAM;QACV,WAAW;QACX,gBAAgB;QAChB,SAAS;QACT,eAAe;QACf,SAAS;QACT,OAAO;QACP,OAAO;QACP,eAAe;YAAE,SAAS;YAAe,UAAU;YAAe,eAAe;QAAc;QAC/F,KAAK;QACL,aAAa;QACb,OAAO,EAAE;QACT,iBAAiB;YAAE,SAAS;YAAO,cAAc;YAAU,OAAO;QAAE;QACpE,gBAAgB,EAAE;QAClB,0BAA0B;YAAE,SAAS;YAAM,uBAAuB;YAAQ,wBAAwB;YAAG,WAAW;QAAE;QAClH,gBAAgB;YAAE,UAAU;YAAK,iBAAiB;YAAW,gBAAgB;QAAQ;QACrF,kBAAkB,EAAE;QACpB,WAAW,IAAI,OAAO,WAAW;IACrC;AACJ"}},
    {"offset": {"line": 456, "column": 0}, "map": {"version":3,"sources":["file:///Users/fujinoyouichi/music-studio-app/src/actions/admin-auth.ts"],"sourcesContent":["\"use server\";\n\nimport { cookies } from 'next/headers';\nimport { redirect } from 'next/navigation';\nimport { getAllStudios } from '@/lib/db-studio';\n\nconst ADMIN_CREDENTIALS = {\n    email: \"admin@antigravity.com\",\n    password: \"admin\"\n};\n\nexport async function adminLogin(formData: FormData, isPlatformLogin: boolean = false) {\n    const email = formData.get('email') as string;\n    const password = formData.get('password') as string;\n\n    // 1. Platform Admin Login (Strict Mode)\n    if (isPlatformLogin) {\n        if (email === ADMIN_CREDENTIALS.email && password === ADMIN_CREDENTIALS.password) {\n            const cookieStore = await cookies();\n            cookieStore.set('__session', JSON.stringify({ type: 'admin', token: 'platform_auth' }), {\n                httpOnly: true,\n                secure: true,\n                path: '/',\n                maxAge: 60 * 60 * 24 // 1 day\n            });\n            return { success: true };\n        }\n        return { success: false, message: \"運営管理者IDまたはパスワードが正しくありません。\" };\n    }\n\n    // 2. Studio Accounts Login (Default)\n    const studios = await getAllStudios();\n\n    // Check main studio email\n    const studio = studios.find(s => s.email === email);\n    if (studio) {\n        // For simplicity, we use 'admin' as default password for studio main accounts for now\n        // In a real app, this would be a hashed password in the DB\n        if (password === 'admin') {\n            await storeLogin(studio.id);\n            return { success: true };\n        }\n    }\n\n    // Check staff accounts\n    for (const s of studios) {\n        const staffMember = s.staff?.find(sm => sm.email === email && sm.password === password);\n        if (staffMember) {\n            await storeLogin(s.id);\n            return { success: true };\n        }\n    }\n\n    return { success: false, message: \"店舗IDまたはパスワードが正しくありません。\" };\n}\n\nexport async function storeLogin(studioId: string) {\n    const cookieStore = await cookies();\n    const oneDay = 24 * 60 * 60 * 1000;\n    cookieStore.set('__session', JSON.stringify({ type: 'studio', id: studioId }), {\n        httpOnly: true,\n        secure: true,\n        path: '/',\n        maxAge: 60 * 60 * 24 // 1 day\n    });\n    return { success: true };\n}\n\nexport async function adminLogout() {\n    const cookieStore = await cookies();\n    cookieStore.delete('__session');\n    redirect('/admin/login');\n}\n\nexport async function getAuthInfo() {\n    const cookieStore = await cookies();\n    const session = cookieStore.get('__session')?.value;\n\n    if (!session) return { isAdmin: false, studioId: null };\n\n    try {\n        const data = JSON.parse(session);\n        return {\n            isAdmin: data.type === 'admin',\n            studioId: data.type === 'studio' ? data.id : null\n        };\n    } catch (e) {\n        return { isAdmin: false, studioId: null };\n    }\n}\n\nexport async function checkAdminAuth() {\n    const auth = await getAuthInfo();\n    return auth.isAdmin || !!auth.studioId;\n}\n\nexport async function requireAdminAuth() {\n    const auth = await getAuthInfo();\n    const isAuth = auth.isAdmin || !!auth.studioId;\n\n    if (!isAuth) {\n        // Fallback to platform login if no tokens at all\n        redirect('/admin/platform/login');\n    }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 610, "column": 0}, "map": {"version":3,"sources":["file:///Users/fujinoyouichi/music-studio-app/.next-internal/server/app/admin/platform/login/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {adminLogin as '6095d9b95f263e7a67fcaf6220fc022a92ad42b253'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}