{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///Users/fujinoyouichi/music-studio-app/src/lib/db-local.ts"],"sourcesContent":["import fs from 'fs';\nimport path from 'path';\n\nconst DB_PATH = path.join(process.cwd(), 'data', 'bookings.json');\n\nexport interface Booking {\n    id: string;\n    userId: string;\n    studioId: string;\n    roomName?: string; // Added for detail\n    date: string;       // YYYY-MM-DD\n    startTime: string;  // HH:mm\n    durationHours: number;\n    userCount: number;\n    totalPrice: number;\n    createdAt: string;\n}\n\n// Initialize DB file if not exists\nif (!fs.existsSync(DB_PATH)) {\n    fs.writeFileSync(DB_PATH, JSON.stringify([], null, 2));\n}\n\nexport const getBookings = (): Booking[] => {\n    try {\n        const data = fs.readFileSync(DB_PATH, 'utf-8');\n        return JSON.parse(data);\n    } catch (error) {\n        return [];\n    }\n};\n\nexport const saveBooking = (booking: Booking): void => {\n    const bookings = getBookings();\n    bookings.push(booking);\n    fs.writeFileSync(DB_PATH, JSON.stringify(bookings, null, 2));\n};\n\n// Check for overlaps\nexport const checkAvailability = (studioId: string, roomName: string | undefined, date: string, startTime: string, duration: number): boolean => {\n    const bookings = getBookings();\n\n    // Convert new request to minutes from midnight\n    const [startH, startM] = startTime.split(':').map(Number);\n    const newStart = startH * 60 + startM;\n    const newEnd = newStart + (duration * 60);\n\n    // Filter bookings for the same day AND SAME ROOM\n    const conflictingBookings = bookings.filter(b => {\n        if (b.date !== date) return false;\n        if (b.studioId !== studioId) return false;\n        // If rooms are defined, they must match. If legacy booking has no room, assumption is risky, but let's assume strict match if roomName provided.\n        // For this app, we recently added roomName.\n        if (roomName && b.roomName && b.roomName !== roomName) return false;\n        return true;\n    });\n\n    for (const b of conflictingBookings) {\n        const [h, m] = b.startTime.split(':').map(Number);\n        const bStart = h * 60 + m;\n        const bEnd = bStart + (b.durationHours * 60);\n\n        // Overlap logic: (StartA < EndB) and (EndA > StartB)\n        if (newStart < bEnd && newEnd > bStart) {\n            return false; // Overlap found\n        }\n    }\n    return true; // No overlap\n};\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;;;AAEA,MAAM,UAAU,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,QAAQ;AAejD,mCAAmC;AACnC,IAAI,CAAC,wGAAE,CAAC,UAAU,CAAC,UAAU;IACzB,wGAAE,CAAC,aAAa,CAAC,SAAS,KAAK,SAAS,CAAC,EAAE,EAAE,MAAM;AACvD;AAEO,MAAM,cAAc;IACvB,IAAI;QACA,MAAM,OAAO,wGAAE,CAAC,YAAY,CAAC,SAAS;QACtC,OAAO,KAAK,KAAK,CAAC;IACtB,EAAE,OAAO,OAAO;QACZ,OAAO,EAAE;IACb;AACJ;AAEO,MAAM,cAAc,CAAC;IACxB,MAAM,WAAW;IACjB,SAAS,IAAI,CAAC;IACd,wGAAE,CAAC,aAAa,CAAC,SAAS,KAAK,SAAS,CAAC,UAAU,MAAM;AAC7D;AAGO,MAAM,oBAAoB,CAAC,UAAkB,UAA8B,MAAc,WAAmB;IAC/G,MAAM,WAAW;IAEjB,+CAA+C;IAC/C,MAAM,CAAC,QAAQ,OAAO,GAAG,UAAU,KAAK,CAAC,KAAK,GAAG,CAAC;IAClD,MAAM,WAAW,SAAS,KAAK;IAC/B,MAAM,SAAS,WAAY,WAAW;IAEtC,iDAAiD;IACjD,MAAM,sBAAsB,SAAS,MAAM,CAAC,CAAA;QACxC,IAAI,EAAE,IAAI,KAAK,MAAM,OAAO;QAC5B,IAAI,EAAE,QAAQ,KAAK,UAAU,OAAO;QACpC,iJAAiJ;QACjJ,4CAA4C;QAC5C,IAAI,YAAY,EAAE,QAAQ,IAAI,EAAE,QAAQ,KAAK,UAAU,OAAO;QAC9D,OAAO;IACX;IAEA,KAAK,MAAM,KAAK,oBAAqB;QACjC,MAAM,CAAC,GAAG,EAAE,GAAG,EAAE,SAAS,CAAC,KAAK,CAAC,KAAK,GAAG,CAAC;QAC1C,MAAM,SAAS,IAAI,KAAK;QACxB,MAAM,OAAO,SAAU,EAAE,aAAa,GAAG;QAEzC,qDAAqD;QACrD,IAAI,WAAW,QAAQ,SAAS,QAAQ;YACpC,OAAO,OAAO,gBAAgB;QAClC;IACJ;IACA,OAAO,MAAM,aAAa;AAC9B"}},
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///Users/fujinoyouichi/music-studio-app/src/actions/admin.ts"],"sourcesContent":["\"use server\";\n\nimport { getBookings } from \"@/lib/db-local\";\n\nexport async function fetchBookings() {\n    // In a real server component, we can just call the DB function directly.\n    // Or expose it as a server action if we need client-side fetching.\n    return getBookings().sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\n}\n\nexport async function fetchBookingsByStudio(studioId: string) {\n    const allBookings = getBookings();\n    return allBookings\n        .filter(booking => booking.studioId === studioId)\n        .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\n}\n"],"names":[],"mappings":";;;;;;;AAEA;;;;AAEO,eAAe;IAClB,yEAAyE;IACzE,mEAAmE;IACnE,OAAO,IAAA,kKAAW,IAAG,IAAI,CAAC,CAAC,GAAG,IAAM,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO,KAAK,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO;AACvG;AAEO,eAAe,sBAAsB,QAAgB;IACxD,MAAM,cAAc,IAAA,kKAAW;IAC/B,OAAO,YACF,MAAM,CAAC,CAAA,UAAW,QAAQ,QAAQ,KAAK,UACvC,IAAI,CAAC,CAAC,GAAG,IAAM,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO,KAAK,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO;AACvF;;;IAXsB;IAMA;;AANA,yQAAA;AAMA,yQAAA"}},
    {"offset": {"line": 101, "column": 0}, "map": {"version":3,"sources":["file:///Users/fujinoyouichi/music-studio-app/.next-internal/server/app/admin/%28protected%29/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {adminLogout as '001204c5cf63a9b2296f854320112c5a87dcce6e42'} from 'ACTIONS_MODULE0'\nexport {checkAdminAuth as '00437f65ee5b42f956e8ffc66d1cb8f078eb3f7b8f'} from 'ACTIONS_MODULE0'\nexport {getAuthInfo as '0094447a595c8804f1bc342263046c499a9212ef70'} from 'ACTIONS_MODULE0'\nexport {requireAdminAuth as '00fad050e5d6ad0ce3b05eee5af53765577db154bf'} from 'ACTIONS_MODULE0'\nexport {adminLogin as '4095d9b95f263e7a67fcaf6220fc022a92ad42b253'} from 'ACTIONS_MODULE0'\nexport {storeLogin as '40f94cb5b752928b50e639d0b94db41445b719e91b'} from 'ACTIONS_MODULE0'\nexport {adminLogout as '001204c5cf63a9b2296f854320112c5a87dcce6e42'} from 'ACTIONS_MODULE0'\nexport {getAuthInfo as '0094447a595c8804f1bc342263046c499a9212ef70'} from 'ACTIONS_MODULE0'\nexport {fetchBookings as '00a68c4314eb908d52d8300c546165c38d9396948b'} from 'ACTIONS_MODULE1'\nexport {fetchBookingsByStudio as '40711a429c985a6caa883c71953552fd7b21e6bbf9'} from 'ACTIONS_MODULE1'\n"],"names":[],"mappings":";AAAA;AAQA"}}]
}